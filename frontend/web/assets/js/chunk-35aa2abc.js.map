{"version":3,"sources":["webpack:///./node_modules/core-js/modules/es.json.stringify.js","webpack:///./src/components/CustomerChat.vue","webpack:///./src/components/CustomerChat.vue?f13c"],"names":["$","global","getBuiltIn","apply","uncurryThis","fails","Array","$stringify","exec","charAt","charCodeAt","replace","numberToString","toString","tester","low","hi","fix","match","offset","string","prev","next","FORCED","target","stat","forced","stringify","it","replacer","space","i","l","arguments","length","args","result","ref","data","ShopList","highlight-current-row","handleCurrentChange","max-height","style","property","label","width","CurrentMsg","msg","key","id","align","From","firebase","auth","currentUser","email","Msg","CurrentRow","ShopName","message","tempMsg","placeholder","publish","ShopID","HistoryMsg","methods","val","this","console","log","getAllShopID","axios","get","params","then","response","res","JSON","resobj","parse","arr","push","catch","error","getHistoryMsg","UserId","connectBroker","receivedMsgObj","mqtt","client","connect","Email","on","subscribe","topic","payload","msgObj","Date","now","created","watch","newMsg","__exports__","render"],"mappings":"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","file":"assets/js/chunk-35aa2abc.js","sourcesContent":["var $ = require('../internals/export');\nvar global = require('../internals/global');\nvar getBuiltIn = require('../internals/get-built-in');\nvar apply = require('../internals/function-apply');\nvar uncurryThis = require('../internals/function-uncurry-this');\nvar fails = require('../internals/fails');\n\nvar Array = global.Array;\nvar $stringify = getBuiltIn('JSON', 'stringify');\nvar exec = uncurryThis(/./.exec);\nvar charAt = uncurryThis(''.charAt);\nvar charCodeAt = uncurryThis(''.charCodeAt);\nvar replace = uncurryThis(''.replace);\nvar numberToString = uncurryThis(1.0.toString);\n\nvar tester = /[\\uD800-\\uDFFF]/g;\nvar low = /^[\\uD800-\\uDBFF]$/;\nvar hi = /^[\\uDC00-\\uDFFF]$/;\n\nvar fix = function (match, offset, string) {\n  var prev = charAt(string, offset - 1);\n  var next = charAt(string, offset + 1);\n  if ((exec(low, match) && !exec(hi, next)) || (exec(hi, match) && !exec(low, prev))) {\n    return '\\\\u' + numberToString(charCodeAt(match, 0), 16);\n  } return match;\n};\n\nvar FORCED = fails(function () {\n  return $stringify('\\uDF06\\uD834') !== '\"\\\\udf06\\\\ud834\"'\n    || $stringify('\\uDEAD') !== '\"\\\\udead\"';\n});\n\nif ($stringify) {\n  // `JSON.stringify` method\n  // https://tc39.es/ecma262/#sec-json.stringify\n  // https://github.com/tc39/proposal-well-formed-stringify\n  $({ target: 'JSON', stat: true, forced: FORCED }, {\n    // eslint-disable-next-line no-unused-vars -- required for `.length`\n    stringify: function stringify(it, replacer, space) {\n      for (var i = 0, l = arguments.length, args = Array(l); i < l; i++) args[i] = arguments[i];\n      var result = apply($stringify, null, args);\n      return typeof result == 'string' ? replace(result, tester, fix) : result;\n    }\n  });\n}\n","<template>\n  <el-container>\n    <el-header>\n      <h2>Chat Room</h2>\n    </el-header>\n    <el-container>\n\n      <el-aside>\n        <el-table ref=\"singleTable\" :data=\"ShopList\" highlight-current-row @current-change=\"handleCurrentChange\"\n          max-height=\"1000\" style=\"width: 30%\">\n          <el-table-column property=\"ShopName\" label=\"Shops\" width=\"120\">\n          </el-table-column>\n        </el-table>\n      </el-aside>\n\n      <el-main>\n        <div v-for=\"msg in CurrentMsg\" v-bind:key=\"msg.id\" align=\"left\">\n          <div v-if=\"msg.From === this.firebase.auth().currentUser.email \">You : {{msg.Msg}}</div>\n          <div v-else>{{CurrentRow.ShopName}} : {{msg.Msg}}</div>\n        </div>\n\n        <div>message:{{message}}</div>\n        <el-input v-model=\"tempMsg\" placeholder=\"\" style=\"width:500px\"></el-input>\n        <el-button @click=\"publish('/chat/1087030'+(this.CurrentRow.ShopID-30).toString()+'@nccu.edu.tw', tempMsg)\">send</el-button>\n\n      </el-main>\n\n    </el-container>\n\n\n  </el-container>\n</template>\n\n<script>\n  export default {\n    data() {\n      return {\n        ShopList: [], \n        CurrentRow: null,\n        HistoryMsg: [],\n        CurrentMsg: [],\n        message:\"\", // message recieved\n        tempMsg:\"\", // imput message\n      }\n    },\n\n    methods: {\n      handleCurrentChange(val) {\n        // !! this is currently hard coded due to some uncertainty\n        this.CurrentRow = val;\n        console.log(\"val,this.CurrentRow\", this.CurrentRow);\n        console.log(val.ShopID);\n        this.CurrentMsg = this.HistoryMsg[\"1087030\" + (val.ShopID-30).toString() + \"@nccu.edu.tw\"];\n        console.log(\"currentMsg\", this.CurrentMsg);\n      },\n      getAllShopID(){\n        this.axios.get('http://127.0.0.1:9000/customer/getShopList', {\n          params: {\n            // no parameters\n          }\n        })\n        .then(response=> {\n          let res = JSON.stringify(response.data); \n          let resobj = JSON.parse(res)\n          let arr = resobj.data\n          console.log(arr)\n          for(var i=0;i<arr.length;++i){\n            this.ShopList.push({ ShopID: arr[i].ShopID, ShopName: arr[i].ShopName })\n          }\n          \n        })\n        .catch(error => {\n          console.log(error);\n        })\n        .then(function () {\n          // always executed\n        })\n      },\n      getHistoryMsg(){\n          this.axios.get('http://127.0.0.1:9000/chat/getHistory', {\n          params: {\n            UserId: this.firebase.auth().currentUser.email\n          }\n        })\n        .then(response=> {\n          let res = JSON.stringify(response.data); \n          let resobj = JSON.parse(res);\n          console.log(resobj);\n          this.HistoryMsg = resobj;\n          \n        })\n        .catch(error => {\n          console.log(error);\n        })\n        .then(function () {\n          // always executed\n          \n        })\n\n      },\n      connectBroker(){\n        var mqtt=require('mqtt');\n        const client=mqtt.connect('ws://localhost:8083/mqtt')\n\n        var Email = this.firebase.auth().currentUser.email;\n        var receivedMsgObj;\n\n        client.on('connect', () => {\n          \n          console.log('Listen Method Connected');\n          client.subscribe( '/chat/' + Email ,function(){\n            console.log('subscribed /chat/' + Email);\n          });\n          client.on('message', (topic, payload) => {\n            \n            receivedMsgObj = JSON.parse(payload.toString());\n            console.log(receivedMsgObj);\n            this.CurrentMsg.push(receivedMsgObj);\n            \n          });\n          \n        })\n      },\n      publish(params, msg){\n        \n        this.tempMsg = \"\"; // emty the input\n\n        var mqtt=require('mqtt');\n        const client=mqtt.connect('ws://localhost:8083/mqtt')    \n\n         var msgObj = { \"Msg\" : msg, \n          \"From\" : this.firebase.auth().currentUser.email,\n          \"Date\" : Date.now()\n        }\n\n        this.CurrentMsg.push(msgObj);\n\n        client.on('connect', function () {\n          console.log('Publish Method Connected');\n          client.publish(params, JSON.stringify(msgObj), function(){\n            console.log('published ', msgObj);\n          })\n        })                   \n        \n      }\n    },\n\n    created(){\n      this.getAllShopID(),\n      this.getHistoryMsg(),\n      this.connectBroker()\n    },\n    watch:{\n      message: function(newMsg){\n        console.log('Received Message: ', newMsg)\n        this.message = newMsg\n      }\n    }\n  }\n</script>","import { render } from \"./CustomerChat.vue?vue&type=template&id=f4ab880a\"\nimport script from \"./CustomerChat.vue?vue&type=script&lang=js\"\nexport * from \"./CustomerChat.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/Users/mark/Desktop/分散式/Distributed_System/frontend/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}